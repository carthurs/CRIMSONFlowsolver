TOP = ../..

include $(TOP)/buildoptions.mk

CFLAGS = $(GLOBAL_CFLAGS) $(MPI_INCDIR) $(METIS_INCDIR) $(LESLIB_DEFS) $(LESLIB_INCDIR) $(SOLVERIO_INCDIR) $(FLOWSOLVER_INCDIR)
CXXFLAGS  = $(GLOBAL_CXXFLAGS) $(BLASLAPACK_INCDIR) $(MPI_INCDIR) $(METIS_INCDIR) $(LESLIB_DEFS) $(LESLIB_INCDIR) $(SOLVERIO_INCDIR) $(FLOWSOLVER_INCDIR) \
            $(VERDANDI_INCDIR) $(PETSC_INCDIR) $(BOOSTCPP_INCDIR) $(VTK_INCDIR) $(GOOGLETEST_INCDIR)
FFLAGS   = $(GLOBAL_FFLAGS) $(MPI_INCDIR) $(METIS_INCDIR)

HDRS  =   

CXXSRCS  = CrimsonGlobalArrayTransfer.cxx CrimsonAugStatePart.cxx
CXXSRCS1 = ROUKF_flowsolver.cxx $(CXXSRCS)
CXXSRCS2 = forwardandobserve.cxx $(CXXSRCS)
CXXSRCS3 = main.cxx $(CXXSRCS) 

#CSRCS   = 

#FSRCS   = 

#SRCS  = $(FSRCS) $(CSRCS) $(CXXSRCS)

#OBJS  = $(FSRCS:.f90=.$(OBJECTEXT)) $(CSRCS:.c=.$(OBJECTEXT)) $(CXXSRCS:.cxx=.$(OBJECTEXT))

OBJS1  = $(CXXSRCS1:.cxx=.$(OBJECTEXT))
OBJS2  = $(CXXSRCS2:.cxx=.$(OBJECTEXT))
OBJS3  = $(CXXSRCS3:.cxx=.$(OBJECTEXT))

.PHONY : all
.DEFAULT : all
all: $(TARGET_ESTIMATOR) $(TARGET_FORWARDANDOBSERVE) $(TARGET_FLOWSOLVER)

$(TARGET_ESTIMATOR): $(OBJS1)
	$(LINK_EXE)$(TARGET_ESTIMATOR) $(GLOBAL_LFLAGS) $(OBJS1) \
	$(PETSC_LIBS) $(MPI_LIBS) $(LUA_LIBS) \
	$(FLOWSOLVER_LIBS) $(SOLVERIO_LIBS) $(METIS_LIBS) $(LESLIB_LIBS) $(FLOWSOLVER_LIBS) \
	$(VTK_LIBS) $(BLASLAPACK_LIBS) \
	$(F90_LIBS) $(CXX_LIBS)
					
	mv $(TARGET_ESTIMATOR) $(TOP)/bin
	
$(TARGET_FORWARDANDOBSERVE): $(OBJS2)
	$(LINK_EXE)$(TARGET_FORWARDANDOBSERVE) $(GLOBAL_LFLAGS) $(OBJS2) \
	$(PETSC_LIBS) $(MPI_LIBS) $(LUA_LIBS) \
	$(FLOWSOLVER_LIBS) $(SOLVERIO_LIBS) $(METIS_LIBS) $(LESLIB_LIBS) $(FLOWSOLVER_LIBS) \
	$(VTK_LIBS) $(BLASLAPACK_LIBS) \
	$(F90_LIBS) $(CXX_LIBS)
					
	mv $(TARGET_FORWARDANDOBSERVE) $(TOP)/bin
	
$(TARGET_FLOWSOLVER): $(OBJS3)
	$(LINK_EXE)$(TARGET_FLOWSOLVER) $(GLOBAL_LFLAGS) $(OBJS3) \
	$(FLOWSOLVER_LIBS) $(SOLVERIO_LIBS) $(METIS_LIBS) $(LESLIB_LIBS) $(MEMLS_LIBS) $(FLOWSOLVER_LIBS) \
	$(MPI_LIBS) $(BLASLAPACK_LIBS) $(F90_LIBS) $(CXX_LIBS)
					
	mv $(TARGET_FLOWSOLVER) $(TOP)/bin		

.PHONY : clean
clean : 
	-$(RM) $(OBJS1) $(TARGET_ESTIMATOR) *.mod *.exe *.pdb *.manifest
	-$(RM) $(TOP)/bin/$(TARGET_ESTIMATOR)*
	-$(RM) $(OBJS2) $(TARGET_FORWARDANDOBSERVE) *.mod *.exe *.pdb *.manifest
	-$(RM) $(TOP)/bin/$(TARGET_FORWARDANDOBSERVE)*
	-$(RM) $(OBJS3) $(TARGET_FLOWSOLVER) *.mod *.exe *.pdb *.manifest
	-$(RM) $(TOP)/bin/$(TARGET_FLOWSOLVER)*
